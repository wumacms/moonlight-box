# 《月光宝盒》APP 产品需求文档（PRD）v1.3

## 1. 产品概述

### 1.1 产品定位

月光宝盒是一个「配置驱动 UI」的移动端内容容器。  
它通过 API 配置与字段映射，让同一套客户端可以动态适配文章、视频、图表三类业务数据。

### 1.2 核心问题

- 前端与后端字段强绑定，接口键名变更会触发客户端改版。
- 小范围内容结构调整也需要发版，响应慢、成本高。
- 不同内容形态缺乏统一协议，复用能力弱。

### 1.3 产品目标

- 在 App 内完成 API 注册、独立的列表/详情字段映射、即时预览。
- 通过统一模型承载 `card / video / chart` 三类内容。
- 保证「列表 -> 详情」链路通畅，支持按 `id` 动态下沉并请求详情 API。

## 2. 范围与术语

### 2.1 版本范围（v1.3）

在 v1.2 基础上，强化配置能力与解析深度：

- **映射分离**：支持为列表和详情分别配置独立的字段映射逻辑。
- **智能建议**：支持通过分析真实 API 响应自动生成 JsonPath 映射建议。
- **深度解析**：支持多层嵌套 JSON 结构的 JsonPath 查询（如 `$.data[*].title`）。
- **稳定性增强**：配置列表采用固定的创建时间排序，编辑操作不产生跳动。

### 2.2 术语约定

- **List API**：列表接口，返回卡片集合。
- **Detail API**：详情接口，按 `id` 返回单条详情。
- **字段映射**：标准 UI key 到后端字段 key 或 JsonPath 的映射关系。
- **JsonPath**：用于精准定位深度嵌套 JSON 数据的查询语法。

## 3. 用户与场景

### 3.1 目标用户

- 客户端研发：通过配置快速联调接口，支持复杂嵌套结构。
- 后端研发：在不改客户端代码的情况下调整字段、增加详情字段。
- 产品/测试：验证不同数据结构下页面表现。

### 3.2 核心使用场景

1. 用户在配置页新增 API 配置，填写列表和详情专用 URL。
2. 点击「获取建议」，系统自动请求并分析后端结构，用户从下拉菜单选择映射。
3. 用户点击「测试解析」检查映射结果是否正确。
4. 首页按配置分组（顺序固定）拉取并渲染内容列表。
5. 点击某项，系统按列表 `ui_id` 映射提取 ID，请求详情并应用详情映射渲染。

## 4. 功能需求

### 4.1 配置管理

- 支持新增、编辑、删除 API 配置，列表顺序基于创建时间且支持手动拖拽。
- **强制约束**：`listAPIURL` 为必填项，`detailAPIURL` 在需要进入详情页时为必填项。
- **分段映射**：配置表单分为「列表字段映射」与「详情字段映射」两个独立区域。
- **智能纠错**：核心 ID 映射缺失时，字段标题显示为红色警告。

### 4.2 智能映射建议

- **列表建议**：请求列表 API 并分析第一个条目的 JSON 路径。
- **详情建议**：系统自动从列表获取示例 ID，请求详情 API 并分析其深度嵌套结构。
- **图表特化**：图表类型下，详情字段映射自动转换为图表特有的数据映射（`chart_data`, `chart_x` 等）。

### 4.3 首页渲染

- 严格按照配置列表的顺序（正序）展示分组数据。
- 支持网格/列表模式切换。
- 图表卡片需根据接口及其对应的列表映射渲染。

### 4.4 详情页渲染

- 应用独立的「详情字段映射」规则解析数据。
- 支持 JsonPath 语法，自动过滤 `null` 值的展示，避免空字符串报错。
- 自动识别并展示除映射核心字段外的「扩展信息」。

## 5. 接口与数据协议（参考 1.25 版本）

...（此处保留原有协议示例）...

## 9. 里程碑与后续规划

### 已完成

- 配置驱动渲染主链路打通。
- 三类组件列表与详情接口联调完成。
- **列表与详情字段映射分离实现。**
- **基于 JsonPath 的智能映射建议系统实现。**
- **配置列表与首页展示顺序稳定性优化。**

### 规划中

- API 缓存与离线浏览策略。
- 更丰富的图表交互（筛选、缩放、导出）。
- 支持 POST 请求配置及自定义 Header（用于鉴权）。