# 《月光宝盒》APP 产品需求文档（PRD）v1.2

## 1. 产品概述

### 1.1 产品定位

月光宝盒是一个「配置驱动 UI」的移动端内容容器。  
它通过 API 配置与字段映射，让同一套客户端可以动态适配文章、视频、图表三类业务数据。

### 1.2 核心问题

- 前端与后端字段强绑定，接口键名变更会触发客户端改版。
- 小范围内容结构调整也需要发版，响应慢、成本高。
- 不同内容形态缺乏统一协议，复用能力弱。

### 1.3 产品目标

- 在 App 内完成 API 注册、字段映射、即时预览。
- 通过统一模型承载 `card / video / chart` 三类内容。
- 保证「列表 -> 详情」链路通畅，支持按 `id` 动态下钻。

## 2. 范围与术语

### 2.1 版本范围（v1.2）

在 v1.0 基础上，明确并强化图表能力：

- 首页图表必须基于接口真实数据渲染，不允许使用假数据。
- 图表类型按 `chartType` 驱动（line / pie / bar）。
- 图表详情页同时展示图形与 `chartData` 数据表（x/y 点位）。
- 支持图表字段映射：`chart_data` / `chart_x` / `chart_y`。

### 2.2 术语约定

- **List API**：列表接口，返回卡片集合。
- **Detail API**：详情接口，按 `id` 返回单条详情。
- **字段映射**：标准 UI key 到后端字段 key 的映射关系。
- **extendInfo**：详情扩展字段集合，承载附加信息。

## 3. 用户与场景

### 3.1 目标用户

- 客户端研发：通过配置快速联调接口。
- 后端研发：在不改客户端代码的情况下调整字段。
- 产品/测试：验证不同数据结构下页面表现。

### 3.2 核心使用场景

1. 用户在配置页新增 API 配置，选择组件类型并填写字段映射。
2. 用户点击「测试解析」检查映射结果是否正确。
3. 首页按配置拉取并渲染内容列表。
4. 用户点击某项进入详情页，系统自动携带 `id` 请求详情。

## 4. 功能需求

### 4.1 配置管理

- 支持新增、编辑、删除、排序 API 配置。
- 配置项至少包含：`name`、`listAPIURL`、`detailAPIURL(可选)`、`componentType`、`fieldMapping`。
- 支持即时预览，展示解析后的卡片缩略图。

### 4.2 首页渲染

- 按配置分组展示数据源，每组显示对应卡片集合。
- 支持网格/列表模式切换。
- 支持加载态骨架屏、空态与错误态提示。
- 图表卡片需根据接口数据渲染对应图形，不得使用本地样例值。

### 4.3 详情页渲染

- 通用详情：标题、媒体区域、Markdown 正文、扩展信息。
- 图表详情：渲染图形并展示 `chartData` 点位表格。
- 点位表格规则：左列显示 `x`，右列显示 `y`（可附带单位）。

### 4.4 映射与容错

- 标准映射键：`ui_title`、`ui_subtitle`、`ui_image`、`ui_id`、`ui_badge`。
- 图表扩展映射键：`chart_data`、`chart_x`、`chart_y`。
- 当映射缺失时应提供可理解反馈，不导致应用崩溃。

## 5. 接口与数据协议

### 5.1 通用列表协议

```json
{
  "code": 200,
  "data": {
    "list": [
      {
        "id": "1",
        "title": "标题",
        "subtitle": "副标题",
        "imageUrl": "https://...",
        "badge": "标签"
      }
    ],
    "total": 1
  }
}
```

### 5.2 通用详情协议

```json
{
  "code": 200,
  "data": {
    "id": "1",
    "title": "标题",
    "content": "正文（支持 Markdown）",
    "mediaUrl": "https://...",
    "extendInfo": {}
  }
}
```

### 5.3 图表列表项协议（重点）

```json
{
  "id": "1",
  "title": "近7日活跃用户趋势",
  "subtitle": "每日 DAU 变化（真实采样模拟）",
  "imageUrl": "https://picsum.photos/400/240?random=7",
  "badge": "图表",
  "chartType": "line",
  "period": "7d",
  "unit": "人",
  "chartData": [
    { "x": "02-11", "y": 1280 },
    { "x": "02-12", "y": 1365 }
  ]
}
```

说明：

- `chartType` 决定渲染类型：`line`、`pie`、`bar`。
- `chartData` 为图表和详情表格的共同数据源。
- `unit` 用于数值展示（如：人、%、ms）。

## 6. 交互与体验要求

- 首页点击卡片可进入详情；返回保持滚动位置与浏览上下文。
- 配置页操作反馈及时，错误提示明确可读。
- 深色模式下文本、图表与卡片需保证可读性对比。
- 网络请求失败时提供可重试或可理解提示。

## 7. 非功能需求

- 性能：首页首屏渲染具备加载反馈，避免白屏。
- 稳定性：字段缺失、类型不匹配时应用不崩溃。
- 可维护性：协议变更优先通过映射配置消化。
- 安全性：不得在仓库提交敏感配置与密钥文件。

## 8. 验收标准（UAT）

- 能在配置页完成一条 API 从新增到预览的全流程。
- 首页可同时展示 `card / video / chart` 三类组件。
- 图表卡片与图表详情均使用真实接口数据渲染。
- 图表详情表格逐行展示 `chartData` 的 `x/y` 数据。
- 列表点击详情链路稳定，详情数据与 `id` 一致。

## 9. 里程碑与后续规划

### 已完成

- 配置驱动渲染主链路打通。
- 三类组件列表与详情接口联调完成。
- 图表真实数据渲染与图表详情点位表格支持完成。

### 规划中

- API 缓存与离线浏览策略。
- 映射配置智能推荐（JSON 结构分析）。
- 更丰富的图表交互（筛选、缩放、导出）。